<beans:beans xmlns="http://www.springframework.org/schema/batch" 
     xmlns:beans="http://www.springframework.org/schema/beans"
     xmlns:p="http://www.springframework.org/schema/p"
     xmlns:context="http://www.springframework.org/schema/context"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="
           http://www.springframework.org/schema/beans 	 http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
           http://www.springframework.org/schema/batch   http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">
 
    <beans:bean id="playReader" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.item.play.PlayItemReader"/>
    <beans:bean id="playProcessor" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.item.play.PlayItemProcessor"/>
    <beans:bean id="playWriter" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.item.play.PlayItemWriter"/>
    <beans:bean id="playStepExecutionListener" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.item.play.PlayStepExecutionListener"/>
 
     
	<beans:bean id="erStartTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.StartTasklet"/>
	<beans:bean id="erUpdateTitleTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.UpdateTitleTasklet"/>
	<beans:bean id="erPackageForBermudaTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.PackageForBermudaTasklet"/>
	<beans:bean id="erRunBermudaTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.RunBermudaTasklet"/>
	<beans:bean id="erTransformLinksTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.TransformLinksTasklet"/>
	<beans:bean id="erAssembleBookTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.AssembleBookTasklet"/>
	<beans:bean id="erValidateBookTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.ValidateBookTasklet"/>
	<beans:bean id="erPublishBookTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.PublishBookTasklet"/>

	<beans:bean id="erEndTask" class="com.thomsonreuters.uscl.ereader.orchestrate.engine.step.tasklet.ereader.EndTasklet"/>
    
	<job id="eReaderPublishingJob">
	
		<step id="start" next="updateTitle">
			<tasklet ref="erStartTask"/>
		</step>
		
		<!-- updateTitle goes here -->

		<step id="packageForBermuda">
			<tasklet ref="erPackageForBermudaTask"/>
			<stop on="WAITING" restart="transformLinks"/>
			<stop on="STOPPED" restart="packageForBermuda"/>
			<stop on="FAILED" restart="packageForBermuda"/>
			<next on="COMPLETED" to="runBermuda"/>
		</step>
		<step id="runBermuda">
			<tasklet ref="erRunBermudaTask"/>
			<stop on="STOPPED" restart="runBermuda"/>
			<next on="COMPLETED" to="transformLinks"/>
		</step>
		
		<step id="transformLinks" next="assembleBook">
			<tasklet>
				<chunk reader="playReader"
					   processor="playProcessor"
					   writer="playWriter"
					   commit-interval="3"/>
				<listeners>
					<listener ref="playStepExecutionListener"/>
				</listeners>
			</tasklet>
			<!-- 
			<tasklet ref="erTransformLinksTask"/>
			<stop on="STOPPED" restart="transformLinks"/>
			<next on="COMPLETED" to="assembleBook"/>
			 -->
		</step>
		
		<step id="assembleBook">
			<tasklet ref="erAssembleBookTask"/>
			<stop on="STOPPED" restart="assembleBook"/>
			<next on="COMPLETED" to="validateBook"/>
		</step>
		<step id="validateBook">
			<tasklet ref="erValidateBookTask"/>
			<stop on="STOPPED" restart="validateBook"/>
			<next on="COMPLETED" to="publishBook"/>
		</step>
		<step id="publishBook">
			<tasklet ref="erPublishBookTask"/>
			<stop on="STOPPED" restart="publishBook"/>
			<next on="COMPLETED" to="end"/>
		</step>
		<step id="end">
			<tasklet ref="erEndTask"/>
		</step>
		
		<step id="updateTitle">
			<tasklet ref="erUpdateTitleTask" allow-start-if-complete="true"/>
			<stop on="STOPPED" restart="updateTitle"/>
			<next on="COMPLETED" to="packageForBermuda"/>
		</step>

	</job>

</beans:beans>