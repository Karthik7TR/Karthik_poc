/*
Created: 1/23/2012
Modified: 3/2/2012
Project: COBALT_EBOOK_BUILDER
Model: EBOOK
Company: Thomson Reuters
Author: EBOOK_GENERATOR and EBOOK_MANAGER teams
Version: 2.0
Database: Oracle 10g
*/

-- Create sequences section -------------------------------------------------

CREATE SEQUENCE "AUDIT_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "AUTHOR_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "DOC_TYPE_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "EBOOK_DEFINITION_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "EBOOK_NAME_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "FRONT_MATTER_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "JOB_REQUEST_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "JURIS_TYPE_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "KEYWORD_TYPE_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "KEYWORD_TYPE_VALUES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "PUB_TYPE_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "PUBLISHER_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

CREATE SEQUENCE "STATE_CODES_ID_SEQ"
 INCREMENT BY 1
 START WITH 1
 NOMAXVALUE
 NOMINVALUE
 CACHE 20
/

-- Create Synonyms for Sequences -----------------------------------------

CREATE OR REPLACE SYNONYM "AUDIT_ID_SEQ" FOR "EBOOK"."AUDIT_ID_SEQ";
CREATE OR REPLACE SYNONYM "AUTHOR_ID_SEQ" FOR "EBOOK"."AUTHOR_ID_SEQ";
CREATE OR REPLACE SYNONYM "DOC_TYPE_CODES_ID_SEQ" FOR "EBOOK"."DOC_TYPE_CODES_ID_SEQ";
CREATE OR REPLACE SYNONYM "EBOOK_DEFINITION_ID_SEQ" FOR "EBOOK"."EBOOK_DEFINITION_ID_SEQ";
CREATE OR REPLACE SYNONYM "EBOOK_NAME_ID_SEQ" FOR "EBOOK"."EBOOK_NAME_ID_SEQ";
CREATE OR REPLACE SYNONYM "FRONT_MATTER_ID_SEQ" FOR "EBOOK"."FRONT_MATTER_ID_SEQ";
CREATE OR REPLACE SYNONYM "JOB_REQUEST_ID_SEQ" FOR "EBOOK"."JOB_REQUEST_ID_SEQ";
CREATE OR REPLACE SYNONYM "JURIS_TYPE_CODES_ID_SEQ" FOR "EBOOK"."JURIS_TYPE_CODES_ID_SEQ";
CREATE OR REPLACE SYNONYM "KEYWORD_TYPE_CODES_ID_SEQ" FOR "EBOOK"."KEYWORD_TYPE_CODES_ID_SEQ";
CREATE OR REPLACE SYNONYM "KEYWORD_TYPE_VALUES_ID_SEQ" FOR "EBOOK"."KEYWORD_TYPE_VALUES_ID_SEQ";
CREATE OR REPLACE SYNONYM "PUB_TYPE_CODES_ID_SEQ" FOR "EBOOK"."PUB_TYPE_CODES_ID_SEQ";
CREATE OR REPLACE SYNONYM "PUBLISHER_CODES_ID_SEQ" FOR "EBOOK"."PUBLISHER_CODES_ID_SEQ";
CREATE OR REPLACE SYNONYM "STATE_CODES_ID_SEQ" FOR "EBOOK"."STATE_CODES_ID_SEQ";

-- Create tables section -------------------------------------------------

-- Table EBOOK.XSLT_MAPPER

CREATE TABLE "EBOOK"."XSLT_MAPPER"(
  "COLLECTION" Varchar2(30 ),
  "DOC_TYPE" Varchar2(10 ),
  "CONTENT_TYPE" Varchar2(80 ),
  "XSLT" Varchar2(50 )
)
/

-- Table EBOOK.SCHEMA_VERSION

CREATE TABLE "EBOOK"."SCHEMA_VERSION"(
  "SCHEMA_VERSION" Number NOT NULL,
  "COMMENTS" Varchar2(4000 ) NOT NULL,
  "CHANGE_DATE" Timestamp(3) DEFAULT sysdate NOT NULL
)
/

INSERT INTO EBOOK.SCHEMA_VERSION (SCHEMA_VERSION, COMMENTS, CHANGE_DATE)
VALUES (1.0, 'Initial model created.', TO_DATE('01/23/2012', 'MM/DD/YYYY'));

INSERT INTO EBOOK.SCHEMA_VERSION (SCHEMA_VERSION, COMMENTS, CHANGE_DATE)
VALUES (1.1, 'Updated XSLT_MAPPER.XSLT from Varchar2(30) to Varchar2(50).', TO_DATE('01/26/2012', 'MM/DD/YYYY'));

INSERT INTO EBOOK.SCHEMA_VERSION (SCHEMA_VERSION, COMMENTS, CHANGE_DATE)
VALUES (2.0, 'Updated model to new EBOOK schema as agreed by EBOOK_GENERATOR and EBOOK_MANAGER teams.', TO_DATE('03/02/2012', 'MM/DD/YYYY'));

COMMIT;

-- Table EBOOK.AUTHOR

CREATE TABLE "EBOOK"."AUTHOR"(
  "AUTHOR_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "AUTHOR_NAME_PREFIX" Varchar2(40 ),
  "AUTHOR_NAME_SUFFIX" Varchar2(40 ),
  "AUTHOR_FIRST_NAME" Varchar2(1024 ),
  "AUTHOR_MIDDLE_NAME" Varchar2(1024 ),
  "AUTHOR_LAST_NAME" Varchar2(1024 ) NOT NULL,
  "AUTHOR_ADDL_TEXT" Varchar2(1024 )
)
/

-- Add keys for table EBOOK.AUTHOR

ALTER TABLE "EBOOK"."AUTHOR" ADD CONSTRAINT "AUTHOR_PK" PRIMARY KEY ("AUTHOR_ID")
/

-- Table EBOOK.JOB_REQUEST

CREATE TABLE "EBOOK"."JOB_REQUEST"(
  "JOB_REQUEST_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "BOOK_VERISON_SUBMITTED" Varchar2(10 ) NOT NULL,
  "JOB_STATUS" Varchar2(40 ) NOT NULL,
  "JOB_PRIORITY" Number NOT NULL,
  "JOB_SCHEDULE_TIMESTAMP" Timestamp(6),
  "JOB_SUBMITTER_NAME" Varchar2(1024 ) NOT NULL,
  "JOB_SUBMIT_TIMESTAMP" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.JOB_REQUEST

ALTER TABLE "EBOOK"."JOB_REQUEST" ADD CONSTRAINT "JOB_REQUEST_PK" PRIMARY KEY ("JOB_REQUEST_ID")
/

-- Table EBOOK.DOCUMENT_TYPE_CODES

CREATE TABLE "EBOOK"."DOCUMENT_TYPE_CODES"(
  "DOCUMENT_TYPE_CODES_ID" Number NOT NULL,
  "DOCUMENT_TYPE_CODES_ABBRV" Varchar2(32 ) NOT NULL,
  "DOCUMENT_TYPE_CODES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.DOCUMENT_TYPE_CODES

ALTER TABLE "EBOOK"."DOCUMENT_TYPE_CODES" ADD CONSTRAINT "DOCUMENT_TYPE_CODES_PK" PRIMARY KEY ("DOCUMENT_TYPE_CODES_ID")
/

-- Table EBOOK.EBOOK_DEFINITION

CREATE TABLE "EBOOK"."EBOOK_DEFINITION"(
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "TITLE_ID" Varchar2(40 ) NOT NULL,
  "PROVIEW_DISPLAY_NAME" Varchar2(1024 ),
  "COPYRIGHT" Varchar2(1024 ) NOT NULL,
  "COPYRIGHT_PAGE_TEXT" Varchar2(1024 ),
  "MATERIAL_ID" Varchar2(64 ) NOT NULL,
  "IS_TOC_FLAG" Char(1 ) NOT NULL,
  "ROOT_TOC_GUID" Varchar2(64 ),
  "DOC_COLLECTION_NAME" Varchar2(64 ),
  "TOC_COLLECTION_NAME" Varchar2(64 ),
  "NORT_DOMAIN" Varchar2(64 ),
  "NORT_FILTER_VIEW" Varchar2(64 ),
  "DOCUMENT_TYPE_CODES_ID" Number,
  "COVER_IMAGE" Varchar2(256 ),
  "ISBN" Varchar2(64 ),
  "PUBLISH_DATE_TEXT" Varchar2(1024 ),
  "PUBLISHER_CODES_ID" Number,
  "CURRENCY" Varchar2(1024 ),
  "KEYCITE_TOPLINE_FLAG" Char(1 ),
  "AUTO_UPDATE_SUPPORT_FLAG" Char(1 ),
  "SEARCH_INDEX_FLAG" Char(1 ),
  "ONE_PASS_SSO_LINK_FLAG" Char(1 ),
  "PUBLISH_CUTOFF_DATE" Timestamp(6),
  "EBOOK_DEFINITION_COMPLETE_FLAG" Char(1 ) DEFAULT 'N' NOT NULL,
  "PUBLISHED_ONCE_FLAG" Char(1 ) DEFAULT 'N' NOT NULL,
  "IS_DELETED_FLAG" Char(1 ) DEFAULT 'N' NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.EBOOK_DEFINITION

ALTER TABLE "EBOOK"."EBOOK_DEFINITION" ADD CONSTRAINT "EBOOK_DEFINITION_PK" PRIMARY KEY ("EBOOK_DEFINITION_ID")
/

-- Table EBOOK.FRONT_MATTER

CREATE TABLE "EBOOK"."FRONT_MATTER"(
  "FRONT_MATTER_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "BOOK_NAME_TEXT" Varchar2(1024 ),
  "SEQUENCE_NUM" Number
)
/

-- Add keys for table EBOOK.FRONT_MATTER

ALTER TABLE "EBOOK"."FRONT_MATTER" ADD CONSTRAINT "FRONT_MATTER_PK" PRIMARY KEY ("FRONT_MATTER_ID")
/

-- Table EBOOK.KEYWORD_TYPE_VALUES

CREATE TABLE "EBOOK"."KEYWORD_TYPE_VALUES"(
  "KEYWORD_TYPE_VALUES_ID" Number NOT NULL,
  "KEYWORD_TYPE_CODES_ID" Number NOT NULL,
  "KEYWORD_TYPE_VALUES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.KEYWORD_TYPE_VALUES

ALTER TABLE "EBOOK"."KEYWORD_TYPE_VALUES" ADD CONSTRAINT "KEYWORD_TYPE_VALUES_PK" PRIMARY KEY ("KEYWORD_TYPE_VALUES_ID")
/

-- Table EBOOK.KEYWORD_TYPE_CODES

CREATE TABLE "EBOOK"."KEYWORD_TYPE_CODES"(
  "KEYWORD_TYPE_CODES_ID" Number NOT NULL,
  "KEYWORD_TYPE_CODES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.KEYWORD_TYPE_CODES

ALTER TABLE "EBOOK"."KEYWORD_TYPE_CODES" ADD CONSTRAINT "KEYWORD_TYPE_CODES_PK" PRIMARY KEY ("KEYWORD_TYPE_CODES_ID")
/

-- Table EBOOK.EBOOK_KEYWORDS

CREATE TABLE "EBOOK"."EBOOK_KEYWORDS"(
  "KEYWORD_TYPE_VALUES_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL
)
/

-- Add keys for table EBOOK.EBOOK_KEYWORDS

ALTER TABLE "EBOOK"."EBOOK_KEYWORDS" ADD CONSTRAINT "EBOOK_AUDIT_PK" PRIMARY KEY ("KEYWORD_TYPE_VALUES_ID","EBOOK_DEFINITION_ID")
/

-- Table EBOOK.PUBLISHER_CODES

CREATE TABLE "EBOOK"."PUBLISHER_CODES"(
  "PUBLISHER_CODES_ID" Number NOT NULL,
  "PUBLISHER_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.PUBLISHER_CODES

ALTER TABLE "EBOOK"."PUBLISHER_CODES" ADD CONSTRAINT "PUBLISHER_CODES_PK" PRIMARY KEY ("PUBLISHER_CODES_ID")
/

-- Table EBOOK.EBOOK_NAME

CREATE TABLE "EBOOK"."EBOOK_NAME"(
  "EBOOK_NAME_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "BOOK_NAME_TEXT" Varchar2(1024 ),
  "SEQUENCE_NUM" Number
)
/

-- Add keys for table EBOOK.EBOOK_NAME

ALTER TABLE "EBOOK"."EBOOK_NAME" ADD CONSTRAINT "EBOOK_NAME_PK" PRIMARY KEY ("EBOOK_NAME_ID")
/

-- Table EBOOK.EBOOK_AUDIT

CREATE TABLE "EBOOK"."EBOOK_AUDIT"(
  "AUDIT_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "TITLE_ID" Varchar2(40 ) NOT NULL,
  "COPYRIGHT" Varchar2(1024 ) NOT NULL,
  "COPYRIGHT_PAGE_TEXT" Varchar2(1024 ),
  "MATERIAL_ID" Varchar2(64 ) NOT NULL,
  "IS_TOC_FLAG" Char(1 ) NOT NULL,
  "ROOT_TOC_GUID" Varchar2(64 ),
  "DOC_COLLECTION_NAME" Varchar2(64 ),
  "TOC_COLLECTION_NAME" Varchar2(64 ),
  "NORT_DOMAIN" Varchar2(64 ),
  "NORT_FILTER_VIEW" Varchar2(64 ),
  "DOCUMENT_TYPE_CODES_ID" Number,
  "COVER_IMAGE" Varchar2(256 ),
  "ISBN" Varchar2(64 ),
  "PUBLISH_DATE_TEXT" Varchar2(1024 ),
  "PUBLISHER_CODES_ID" Number,
  "CURRENCY" Varchar2(1024 ),
  "KEYCITE_TOPLINE_FLAG" Char(1 ),
  "AUTO_UPDATE_SUPPORT_FLAG" Char(1 ),
  "SEARCH_INDEX_FLAG" Char(1 ),
  "ONE_PASS_SSO_LINK_FLAG" Char(1 ),
  "EBOOK_DEFINITION_COMPLETE_FLAG" Char(1 ),
  "PUBLISHED_ONCE_FLAG" Char(1 ),
  "AUTHOR_NAMES_CONCAT" Varchar2(1024 ),
  "BOOK_NAMES_CONCAT" Varchar2(1024 ),
  "KEYWORDS_CONCAT" Varchar2(1024 ),
  "FRONT_MATTER_CONCAT" Varchar2(1024 ),
  "AUDIT_NOTE" Varchar2(1024 ),
  "AUDIT_TYPE" Varchar2(10 ) NOT NULL,
  "UPDATED_BY" Varchar2(32 ) NOT NULL,
  "TIMESTAMP" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.EBOOK_AUDIT

ALTER TABLE "EBOOK"."EBOOK_AUDIT" ADD CONSTRAINT "AUDIT_PK" PRIMARY KEY ("AUDIT_ID")
/

-- Table EBOOK.PUBLISHING_STATS

CREATE TABLE "EBOOK"."PUBLISHING_STATS"(
  "JOB_INSTANCE_ID" Number NOT NULL,
  "PUBLISH_START_TIMESTAMP" Timestamp(6) NOT NULL,
  "GATHER_TOC_NODE_COUNT" Number,
  "GATHER_TOC_SKIPPED_COUNT" Number,
  "GATHER_TOC_DOC_COUNT" Number,
  "GATHER_TOC_RETRY_COUNT" Number,
  "GATHER_DOC_EXPECTED_COUNT" Number,
  "GATHER_DOC_RETRY_COUNT" Number,
  "GATHER_DOC_RETRIEVED_COUNT" Number,
  "GATHER_META_EXPECTED_COUNT" Number,
  "GATHER_META_RETRIEVED_COUNT" Number,
  "GATHER_META_RETRY_COUNT" Number,
  "GATHER_IMAGE_EXPECTED_COUNT" Number,
  "GATHER_IMAGE_RETRIEVED_COUNT" Number,
  "GATHER_IMAGE_RETRY_COUNT" Number,
  "FORMAT_DOC_COUNT" Number,
  "ASSEMBLE_DOC_COUNT" Number,
  "TITLE_DOC_COUNT" Number,
  "TITLE_DUP_DOC_COUNT" Number,
  "PUBLISH_STATUS" Varchar2(1024 ),
  "PUBLISH_END_TIMESTAMP" Timestamp(6),
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.PUBLISHING_STATS

ALTER TABLE "EBOOK"."PUBLISHING_STATS" ADD CONSTRAINT "PUBLISHING_STATS_PK" PRIMARY KEY ("JOB_INSTANCE_ID")
/

-- Table EBOOK.PUBLISHING_HISTORY

CREATE TABLE "EBOOK"."PUBLISHING_HISTORY"(
  "JOB_INSTANCE_ID" Number NOT NULL,
  "AUDIT_ID" Number NOT NULL,
  "EBOOK_DEFINITION_ID" Number NOT NULL,
  "BOOK_VERSION_SUBMITTED" Varchar2(10 ) NOT NULL,
  "JOB_HOST_NAME" Varchar2(10 ) NOT NULL,
  "JOB_SUBMITTER_NAME" Varchar2(1024 ) NOT NULL,
  "JOB_SUBMIT_TIMESTAMP" Timestamp(6) NOT NULL
)
/

-- Add keys for table EBOOK.PUBLISHING_HISTORY

ALTER TABLE "EBOOK"."PUBLISHING_HISTORY" ADD CONSTRAINT "PUBLISHING_HISTORY_PK" PRIMARY KEY ("JOB_INSTANCE_ID")
/

-- Table EBOOK.JURIS_TYPE_CODES

CREATE TABLE "EBOOK"."JURIS_TYPE_CODES"(
  "JURIS_TYPE_CODES_ID" Number NOT NULL,
  "JURIS_TYPE_CODES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.JURIS_TYPE_CODES

ALTER TABLE "EBOOK"."JURIS_TYPE_CODES" ADD CONSTRAINT "JURIS_TYPE_CODES_PK" PRIMARY KEY ("JURIS_TYPE_CODES_ID")
/

-- Table EBOOK.STATE_CODES

CREATE TABLE "EBOOK"."STATE_CODES"(
  "STATE_CODES_ID" Number NOT NULL,
  "STATE_CODES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.STATE_CODES

ALTER TABLE "EBOOK"."STATE_CODES" ADD CONSTRAINT "STATE_CODES_PK" PRIMARY KEY ("STATE_CODES_ID")
/

-- Table EBOOK.PUB_TYPE_CODES

CREATE TABLE "EBOOK"."PUB_TYPE_CODES"(
  "PUB_TYPE_CODES_ID" Number NOT NULL,
  "PUB_TYPE_CODES_NAME" Varchar2(1024 ) NOT NULL,
  "LAST_UPDATED" Timestamp(6) DEFAULT SYSDATE NOT NULL
)
/

-- Add keys for table EBOOK.PUB_TYPE_CODES

ALTER TABLE "EBOOK"."PUB_TYPE_CODES" ADD CONSTRAINT "PUB_TYPE_CODES_PK" PRIMARY KEY ("PUB_TYPE_CODES_ID")
/

-- Create procedures section -------------------------------------------------

CREATE OR REPLACE PROCEDURE "EBOOK"."GRANT_PRIVILEGES"
AS
 V_OWNER  VARCHAR2(30);
 SQL_STMT VARCHAR2(2000);

 CURSOR GET_TABLE_NAMES IS
    SELECT T.TABLE_NAME
    FROM USER_TABLES T;
 
  GET_TBL GET_TABLE_NAMES%ROWTYPE;
    
 CURSOR GET_OBJ_NAMES IS
    SELECT OBJ.OBJECT_NAME
    FROM USER_OBJECTS OBJ
    WHERE OBJ.OBJECT_TYPE = 'PROCEDURE' OR OBJ.OBJECT_TYPE = 'FUNCTION';
  
  GET_OBJ GET_OBJ_NAMES%ROWTYPE;
  
  CURSOR GET_SEQ_NAMES IS
     SELECT SEQUENCE_NAME 
     FROM USER_SEQUENCES;
     
  GET_SEQ GET_SEQ_NAMES%ROWTYPE;

BEGIN
    SELECT USERNAME
    INTO V_OWNER
    FROM USER_USERS;
    
    OPEN GET_TABLE_NAMES;
        LOOP
             FETCH GET_TABLE_NAMES INTO GET_TBL;
             EXIT WHEN GET_TABLE_NAMES%NOTFOUND;
             SQL_STMT := 'GRANT SELECT ON  ' || V_OWNER || '.' || GET_TBL.TABLE_NAME || ' TO EBOOK_READ';
             DBMS_OUTPUT.PUT_LINE(SQL_STMT);
             EXECUTE IMMEDIATE SQL_STMT;
             SQL_STMT := 'GRANT SELECT, INSERT, DELETE, UPDATE ON  ' || V_OWNER || '.' || GET_TBL.TABLE_NAME || ' TO EBOOK_USER';
             DBMS_OUTPUT.PUT_LINE(SQL_STMT);
             EXECUTE IMMEDIATE SQL_STMT;
        END LOOP;
    CLOSE GET_TABLE_NAMES;
    
    OPEN GET_OBJ_NAMES;
        LOOP
             FETCH GET_OBJ_NAMES INTO GET_OBJ;
             EXIT WHEN GET_OBJ_NAMES%NOTFOUND;
             SQL_STMT := 'GRANT EXECUTE ON  ' || V_OWNER || '.' || GET_OBJ.OBJECT_NAME || ' TO EBOOK_USER';
             DBMS_OUTPUT.PUT_LINE(SQL_STMT);
             EXECUTE IMMEDIATE SQL_STMT;
        END LOOP;
    CLOSE GET_OBJ_NAMES;
    
    OPEN GET_SEQ_NAMES;
        LOOP
             FETCH GET_SEQ_NAMES INTO GET_SEQ;
             EXIT WHEN GET_SEQ_NAMES%NOTFOUND;
             SQL_STMT := 'GRANT SELECT ON  ' || V_OWNER || '.' || GET_SEQ.SEQUENCE_NAME || ' TO EBOOK_USER';
             DBMS_OUTPUT.PUT_LINE(SQL_STMT);
             EXECUTE IMMEDIATE SQL_STMT;
        END LOOP;
    CLOSE GET_SEQ_NAMES;

END GRANT_PRIVILEGES;
/

-- Create relationships section ------------------------------------------------- 

ALTER TABLE "EBOOK"."AUTHOR" ADD CONSTRAINT "EBOOK_AUTHOR_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."JOB_REQUEST" ADD CONSTRAINT "JOB_REQUEST_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."EBOOK_DEFINITION" ADD CONSTRAINT "EBOOK_DEFINITION_FK1" FOREIGN KEY ("DOCUMENT_TYPE_CODES_ID") REFERENCES "EBOOK"."DOCUMENT_TYPE_CODES" ("DOCUMENT_TYPE_CODES_ID")
/

ALTER TABLE "EBOOK"."FRONT_MATTER" ADD CONSTRAINT "FRONT_MATTER_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."KEYWORD_TYPE_VALUES" ADD CONSTRAINT "KEYWORD_TYPE_VALUES_FK1" FOREIGN KEY ("KEYWORD_TYPE_CODES_ID") REFERENCES "EBOOK"."KEYWORD_TYPE_CODES" ("KEYWORD_TYPE_CODES_ID")
/

ALTER TABLE "EBOOK"."EBOOK_KEYWORDS" ADD CONSTRAINT "EBOOK_KEYWORDS_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."EBOOK_KEYWORDS" ADD CONSTRAINT "EBOOK_KEYWORDS_FK2" FOREIGN KEY ("KEYWORD_TYPE_VALUES_ID") REFERENCES "EBOOK"."KEYWORD_TYPE_VALUES" ("KEYWORD_TYPE_VALUES_ID")
/

ALTER TABLE "EBOOK"."EBOOK_DEFINITION" ADD CONSTRAINT "EBOOK_DEFINITION_FK2" FOREIGN KEY ("PUBLISHER_CODES_ID") REFERENCES "EBOOK"."PUBLISHER_CODES" ("PUBLISHER_CODES_ID")
/

ALTER TABLE "EBOOK"."EBOOK_NAME" ADD CONSTRAINT "EBOOK_NAME_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."EBOOK_AUDIT" ADD CONSTRAINT "AUDIT_FK1" FOREIGN KEY ("EBOOK_DEFINITION_ID") REFERENCES "EBOOK"."EBOOK_DEFINITION" ("EBOOK_DEFINITION_ID")
/

ALTER TABLE "EBOOK"."PUBLISHING_STATS" ADD CONSTRAINT "PUBLISHING_STATS_FK1" FOREIGN KEY ("JOB_INSTANCE_ID") REFERENCES "EBOOK"."PUBLISHING_HISTORY" ("JOB_INSTANCE_ID")
/

ALTER TABLE "EBOOK"."PUBLISHING_HISTORY" ADD CONSTRAINT "PUBLISHING_HISTORY_FK1" FOREIGN KEY ("AUDIT_ID") REFERENCES "EBOOK"."EBOOK_AUDIT" ("AUDIT_ID")
/



-- Grant permissions section -------------------------------------------------



EXEC EBOOK.GRANT_PRIVILEGES;
