name: eBookGatherer-ci-deploy
  
on: 
  push:
    branches: [ "java*" ]
  workflow_dispatch:
    inputs:
      artifact_version:
        description: 'Version'
        required: true
        default: '2308.0.40'
      BAMS:
        description: 'Artifactory location'
        required: true
        default: 'BuildArtifacts/EditorialContent/EBookGatherer'
      SCMserver:
        description: 'Deployment Manager'
        required: true
        default: 'c851oatscmdfd.int.thomsonreuters.com'
      SCMusername:
        description: 'Server credential'
        required: true
        default: 'asadmin'


env:
  # Define git user email and name to be used for git commits
  GIT_USER_EMAIL: "actions@github.com"
  GIT_USER_NAME: "GitHub Actions"
  ENV_CONFIG_FILE: ".github/env-variables.txt"
  ACTIONS_ALLOW_UNSECURE_COMMANDS: true


jobs:
 checkstyle:
    name: Deploy        
     
    runs-on: [self-hosted, C343URQSCMAHP-SCM-GEN1-BuildMachine]

    steps:

    # - name: display war files
    #   run: |
    #     $SCMpassword1=(cat D:\password\password.txt)
    #     net use z: /delete
    #     net use /persistent:yes z: \\cobaltreleaseqc.int.westgroup.com\cobaltreleaseqc$ %SCMpassword1% /USER:svcTFSNGService
    #     rmdir  z:\eBookGatherer\${{github.event.inputs.artifact_version}}
    #     mkdir  z:\eBookGatherer\${{github.event.inputs.artifact_version}}
    #     copy ${{ github.workspace }}\* z:\eBookGatherer\${{github.event.inputs.artifact_version}}
    #   shell: cmd

      # - uses: jfrog/setup-jfrog-cli@v3
      #   env:
      #     # JFrog platform url (for example: https://acme.jfrog.io) 
      #     JF_URL: https://tr1.jfrog.io/artifactory
          
      #     # Basic authentication credentials
      #     JF_USER: ${{ secrets.SCM_JFROG_ACCOUNT_NAME }}
      #     JF_PASSWORD: ${{ secrets.SCM_JFROG_API_TOKEN }}
      # - run: |
      #     jf rt dl generic-local/SCM-Publishing/BuildArtifacts/EditorialContent/EBookGatherer/${{github.event.inputs.artifact_version}}/eBookGatherer.war .

    - name: display war files
      run: |
        curl -u  ${{ secrets.SCM_JFROG_ACCOUNT_NAME }}:${{ secrets.SCM_JFROG_API_TOKEN }} https://tr1.jfrog.io/artifactory/generic-local/SCM-Publishing/BuildArtifacts/EditorialContent/EBookGatherer/2308.0.40/eBookGatherer.war -o eBookGatherer.war
        ls -ltr
        